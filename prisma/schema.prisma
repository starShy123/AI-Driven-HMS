// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL") 
}

// Enums for better type safety
enum UserRole {
  PATIENT
  HEALTHCARE_WORKER
  ADMIN
  COMMUNITY_HEALTH_WORKER
}

enum Gender {
  MALE
  FEMALE
  OTHER
}

enum UrgencyLevel {
  LOW
  MEDIUM
  HIGH
  EMERGENCY
}

enum ConsultationStatus {
  PENDING
  IN_PROGRESS
  COMPLETED
  EMERGENCY
}

enum Language {
  EN
  BN
}

enum ResourceType {
  GOVERNMENT_CLINIC
  NGO_CLINIC
  PHARMACY
  HOSPITAL
  MOBILE_MEDICAL_TEAM
  COMMUNITY_HEALTH_CENTER
}

enum EmergencyType {
  MEDICAL_EMERGENCY
  PREGNANCY_COMPLICATION
  STROKE
  INFECTION
  INJURY
  OTHER
}

enum ContentType {
  HEALTH_EDUCATION
  DISEASE_PREVENTION
  MATERNAL_HEALTH
  NUTRITION
  SEASONAL_HEALTH
  EMERGENCY_CARE
}

// User Management
model User {
  id        String   @id @default(cuid())
  email     String   @unique
  password  String
  role      UserRole @default(PATIENT)
  
  // Personal Information
  firstName String
  lastName  String
  phone     String?
  dateOfBirth DateTime?
  gender    Gender?
  
  // Location Information
  village   String?
  upazila   String?
  district  String?
  division  String?
  latitude  Float?
  longitude Float?
  
  // Medical Information
  medicalHistory String?
  allergies      String?
  currentMedications String?
  
  // System Fields
  isActive    Boolean @default(true)
  isVerified  Boolean @default(false)
  lastLogin   DateTime?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  
  // Relations
  consultations     Consultation[]
  emergencyContacts EmergencyContact[]
  healthRecords     HealthRecord[]
  symptomReports    SymptomReport[]
  voiceInteractions VoiceInteraction[]
  
  @@map("users")
}

// Emergency Contacts
model EmergencyContact {
  id     String @id @default(cuid())
  userId String
  
  name  String
  phone String
  relationship String
  isPrimary Boolean @default(false)
  
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  
  user User @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  @@map("emergency_contacts")
}

// AI Consultations
model Consultation {
  id     String @id @default(cuid())
  userId String
  
  symptoms      String // JSON string of symptoms
  aiResponse    String?
  urgencyLevel  UrgencyLevel?
  status        ConsultationStatus @default(PENDING)
  language      Language @default(EN)
  
  // AI Analysis Results
  possibleConditions String? // JSON array
  recommendations    String? // JSON array
  riskScore         Float?
  
  // Location and Context
  consultationLocation String?
  
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  
  user User @relation(fields: [userId], references: [id], onDelete: Cascade)
  emergencyAlerts EmergencyAlert[]
  
  @@map("consultations")
}

// Emergency Alerts
model EmergencyAlert {
  id             String @id @default(cuid())
  consultationId String
  
  emergencyType    EmergencyType
  urgencyLevel     UrgencyLevel @default(EMERGENCY)
  alertMessage     String
  recommendedAction String
  
  // Location for emergency response
  latitude         Float?
  longitude        Float?
  
  // Response tracking
  isResolved       Boolean @default(false)
  resolvedAt       DateTime?
  resolvedBy       String?
  
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  
  consultation Consultation @relation(fields: [consultationId], references: [id], onDelete: Cascade)
  
  @@map("emergency_alerts")
}

// Symptom Reports
model SymptomReport {
  id     String @id @default(cuid())
  userId String
  
  symptom      String
  severity     Int      // 1-10 scale
  duration     String   // e.g., "2 hours", "3 days"
  additionalNotes String?
  
  // AI Analysis
  analyzedByAI Boolean @default(false)
  aiClassification String?
  
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  
  user User @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  @@map("symptom_reports")
}

// Medical Resources
model MedicalResource {
  id     String @id @default(cuid())
  
  name        String
  type        ResourceType
  description String?
  
  // Contact Information
  phone       String?
  email       String?
  website     String?
  
  // Location
  address     String
  village     String?
  upazila     String?
  district    String?
  division    String?
  latitude    Float
  longitude   Float
  
  // Availability
  isActive     Boolean @default(true)
  operatingHours String? // JSON object with hours
  services     String? // JSON array of services
  
  // Rating and feedback
  averageRating Float @default(0)
  totalReviews  Int   @default(0)
  
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  
  @@map("medical_resources")
}

// Health Records
model HealthRecord {
  id     String @id @default(cuid())
  userId String
  
  recordType String // e.g., "BLOOD_PRESSURE", "TEMPERATURE", "WEIGHT"
  value      String
  unit       String? // e.g., "mmHg", "Â°C", "kg"
  notes      String?
  
  recordedAt DateTime @default(now())
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt
  
  user User @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  @@map("health_records")
}

// Health Education Content
model HealthEducationContent {
  id     String @id @default(cuid())
  
  title     String
  content   String
  type      ContentType
  language  Language @default(EN)
  
  // Targeting
  targetAudience String? // e.g., "pregnant_women", "elderly", "children"
  tags          String? // JSON array of tags
  
  // Seasonal and location-specific
  season       String? // e.g., "monsoon", "winter"
  division     String? // Bangladesh division
  
  // AI-generated content flag
  isAIGenerated Boolean @default(false)
  
  // Engagement metrics
  views        Int @default(0)
  likes        Int @default(0)
  shares       Int @default(0)
  
  isActive     Boolean @default(true)
  publishedAt  DateTime?
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt
  
  @@map("health_education_content")
}

// Voice Interactions
model VoiceInteraction {
  id     String @id @default(cuid())
  userId String
  
  // Voice input
  audioUrl       String?
  transcribedText String?
  language       Language @default(EN)
  
  // AI Response
  aiResponseText String?
  responseAudioUrl String?
  
  // Context
  consultationId String?
  
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  
  user User @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  @@map("voice_interactions")
}

// Disease Tracking and Analytics
model DiseaseTracking {
  id     String @id @default(cuid())
  
  diseaseName String
  region      String // upazila/district/division
  
  // Case counts
  reportedCases   Int @default(0)
  suspectedCases  Int @default(0)
  resolvedCases   Int @default(0)
  
  // Trend data
  trendDirection String? // "increasing", "decreasing", "stable"
  riskLevel      String? // "low", "medium", "high"
  
  // Date range
  reportedDate DateTime
  dataSource   String?
  
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  
  @@map("disease_tracking")
}

// Community Health Worker Assignments
model CHWAssignment {
  id     String @id @default(cuid())
  
  workerId String
  area     String // assigned area/village
  upazila  String
  district String
  
  // Assignment details
  assignedAt DateTime @default(now())
  isActive   Boolean @default(true)
  
  // Performance metrics
  patientsVisited Int @default(0)
  emergenciesHandled Int @default(0)
  
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  
  @@map("chw_assignments")
}

// System Configuration
model SystemConfig {
  id    String @id @default(cuid())
  key   String @unique
  value String
  
  description String?
  isActive    Boolean @default(true)
  
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  
  @@map("system_config")
}
